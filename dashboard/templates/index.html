<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPS Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .stat-card {
            background: linear-gradient(45deg, #4e73df, #224abe);
            color: white;
        }
        .alert-card {
            max-height: 400px;
            overflow-y: auto;
        }
        .scan-progress {
            height: 20px;
            margin-bottom: 10px;
        }
        .scan-type {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .confidence {
            font-weight: bold;
            color: #4e73df;
        }
        .confidence.high {
            color: #e74a3b;
        }
        .confidence.medium {
            color: #f39c12;
        }
        .confidence.low {
            color: #1cc88a;
        }
        .threat-card {
            height: 300px;
        }
        .ip-list {
            height: 200px;
            overflow-y: auto;
        }
        .ip-item {
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .ip-item:last-child {
            border-bottom: none;
        }
        .scan-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .scan-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .scan-item:last-child {
            border-bottom: none;
        }
        .scan-item .ip {
            font-weight: bold;
            color: #4e73df;
        }
        .scan-item .type {
            color: #858796;
        }
        .scan-item .confidence {
            font-weight: bold;
        }
        .scan-item .timestamp {
            color: #858796;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <h1 class="mb-4">IPS Dashboard</h1>
        
        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title">Total Packets</h5>
                        <h2 id="total-packets">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title">Blocked Packets</h5>
                        <h2 id="blocked-packets">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title">Block Rate</h5>
                        <h2 id="block-rate">0%</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scan Detection Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Scan Detection</h5>
                        <div id="scan-stats">
                            <div class="scan-type">
                                <span>Stealth Scan:</span>
                                <span id="stealth-scan-confidence" class="confidence">0%</span>
                            </div>
                            <div class="scan-type">
                                <span>Version Scan:</span>
                                <span id="version-scan-confidence" class="confidence">0%</span>
                            </div>
                            <div class="scan-type">
                                <span>OS Detection:</span>
                                <span id="os-scan-confidence" class="confidence">0%</span>
                            </div>
                            <div class="scan-type">
                                <span>Aggressive Scan:</span>
                                <span id="aggressive-scan-confidence" class="confidence">0%</span>
                            </div>
                            <div class="scan-type">
                                <span>Protocol Probes:</span>
                                <span id="protocol-probes-confidence" class="confidence">0%</span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <strong>Scan Duration:</strong> <span id="scan-duration">0</span> seconds
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Scans Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Active Scans</h5>
                    </div>
                    <div class="card-body">
                        <div id="active-scans" class="scan-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scan Alerts Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Recent Scan Alerts</h5>
                    </div>
                    <div class="card-body">
                        <div id="scan-alerts" class="scan-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Alerts -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Recent Alerts</h5>
                    </div>
                    <div class="card-body alert-card">
                        <div id="alerts"></div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-md-4">
                <!-- Recent IPs -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Recent IPs</h5>
                    </div>
                    <div class="card-body ip-list">
                        <div id="recent-ips"></div>
                    </div>
                </div>

                <!-- Top Threats -->
                <div class="card threat-card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Top Threats</h5>
                    </div>
                    <div class="card-body">
                        <div id="top-threats"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const socket = io();
        
        function updateStats(data) {
            document.getElementById('total-packets').textContent = data.total_packets;
            document.getElementById('blocked-packets').textContent = data.blocked_packets;
            document.getElementById('block-rate').textContent = data.block_rate.toFixed(2) + '%';
            
            // Update scan confidence percentages
            const scanTypes = ['stealth_scan', 'version_scan', 'os_scan', 'aggressive_scan', 'protocol_probes'];
            scanTypes.forEach((type, index) => {
                const confidenceElement = document.getElementById(`${type.replace('_', '-')}-confidence`);
                const confidence = data.scan_stats[type].confidence;
                confidenceElement.textContent = confidence.toFixed(1) + '%';
                
                // Add color coding based on confidence level
                confidenceElement.className = 'confidence';
                if (confidence >= 80) {
                    confidenceElement.classList.add('high');
                } else if (confidence >= 50) {
                    confidenceElement.classList.add('medium');
                } else {
                    confidenceElement.classList.add('low');
                }
            });
            
            // Update scan duration
            document.getElementById('scan-duration').textContent = data.scan_duration.toFixed(1);
            
            // Update alerts
            const alertsDiv = document.getElementById('alerts');
            alertsDiv.innerHTML = '';
            data.alerts.forEach(alert => {
                const alertElement = document.createElement('div');
                alertElement.className = 'alert alert-warning';
                alertElement.textContent = alert;
                alertsDiv.appendChild(alertElement);
            });
            
            // Update recent IPs
            const ipsDiv = document.getElementById('recent-ips');
            ipsDiv.innerHTML = '';
            data.recent_ips.forEach(ip => {
                const ipElement = document.createElement('div');
                ipElement.className = 'ip-item';
                ipElement.textContent = ip;
                ipsDiv.appendChild(ipElement);
            });
            
            // Update top threats
            const threatsDiv = document.getElementById('top-threats');
            threatsDiv.innerHTML = '';
            data.top_threats.forEach(threat => {
                const threatElement = document.createElement('div');
                threatElement.className = 'ip-item';
                threatElement.textContent = threat;
                threatsDiv.appendChild(threatElement);
            });
            
            // Update active scans
            const activeScansDiv = document.getElementById('active-scans');
            activeScansDiv.innerHTML = '';
            Object.entries(data.active_scans).forEach(([ip, scan]) => {
                const scanElement = document.createElement('div');
                scanElement.className = 'scan-item';
                scanElement.innerHTML = `
                    <div>
                        <span class="ip">${ip}</span>
                        <span class="type">${scan.type}</span>
                    </div>
                    <div>
                        <span class="confidence">${scan.count} attempts</span>
                        <span class="timestamp">${Math.round((time.time() - scan.start_time))}s ago</span>
                    </div>
                `;
                activeScansDiv.appendChild(scanElement);
            });
            
            // Update scan alerts
            const scanAlertsDiv = document.getElementById('scan-alerts');
            scanAlertsDiv.innerHTML = '';
            data.scan_alerts.forEach(alert => {
                const alertElement = document.createElement('div');
                alertElement.className = 'scan-item';
                alertElement.innerHTML = `
                    <div>
                        <span class="ip">${alert.ip}</span>
                        <span class="type">${alert.type}</span>
                    </div>
                    <div>
                        <span class="confidence">${alert.confidence.toFixed(1)}%</span>
                        <span class="timestamp">${alert.timestamp}</span>
                    </div>
                `;
                scanAlertsDiv.appendChild(alertElement);
            });
        }
        
        // Initial stats update
        fetch('/api/stats')
            .then(response => response.json())
            .then(data => updateStats(data));
        
        // Listen for real-time updates
        socket.on('alert', function(data) {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => updateStats(data));
        });
    </script>
</body>
</html> 